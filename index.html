<!DOCTYPE html>
<html>

<head>
    <title>Detect Entities</title>
</head>

<body>
    <h1>Detect Entities</h1>
    <b>Enter the text:</b><br>
    <textarea id="inputText" rows="4" cols="50" placeholder="Enter text"></textarea><br><br>

    <button onclick="detectEntities()">Detect Entities</button><br><br>

    <b>Output:</b><br>
    <!-- <textarea id="outputText" rows="4" cols="50" readonly></textarea><br><br> -->
    <div id="outputText" style="white-space: pre-line;"></div><br><br>
    <script src="convertToAbbreviations.js"></script>
    <script src="wordsToNumbers.js"></script>
    <script>

        function detectEntities() {
            //hacemos un fetch del documento system_entities.json y guardamos numero y colores
            fetch('entities.json')
                .then(response => response.json())
                .then(data => {
                    const continents = data.custom.continents;
                    const carBrands = data.custom.carBrands;
                    const clothingBrands = data.custom.clothingBrands;
                    const countries = data.system.countries;
                    const countryCapitals = data.system.countryCapitals;
                    const usaStates = data.system.usaStates;
                    const colors = data.system.colors;
                    const airports = data.system.airports;
                    const languages = data.system.languages;
                    const unitsLength = data.system.unitsLength;
                    const unitsWeight = data.system.unitsWeight;
                    const unitsSpeed = data.system.unitsSpeed;
                    const unitsArea = data.system.unitsArea;
                    const unitsVolume = data.system.unitsVolume;
                    const unitsInformation = data.system.unitsInformation;
                    const inputTextArea = document.getElementById("inputText");
                    const outputDiv = document.getElementById("outputText");

                    const inputText = inputTextArea.value;

                    if (inputText.trim() === '') {
                        alert("Please enter some text.");
                        return;
                    }
                    ;

                    //función para determinar si una palabra está en la lista de países
                    const isCountry = (word) => countries.map(country => country.toLowerCase()).includes(word.toLowerCase());
                    //función para determinar si una palabra está en la lista de capitales
                    const isCountryCapital = (word) => countryCapitals.map(countryCapital => countryCapital.toLowerCase()).includes(word.toLowerCase());
                    //función para determinar si una palabra está en la lista de estados de EEUU
                    const isUsaState = (word) => usaStates.map(usaState => usaState.toLowerCase()).includes(word.toLowerCase());
                    //función para determinar si una palabra está en la lista de marcas de coche
                    const isCarBrand = (word) => carBrands.map(carBrand => carBrand.toLowerCase()).includes(word.toLowerCase());
                    //función para determinar si una palabra está en la lista de marcas de ropa
                    const isClothingBrand = (word) => clothingBrands.map(clothingBrand => clothingBrand.toLowerCase()).includes(word.toLowerCase());
                    //función para determinar si una palabra está en la lista de colores
                    const isColor = (word) => colors.map(color => color.toLowerCase()).includes(word.toLowerCase());
                    //función para determinar si una palabra está en la lista de continentes
                    const isContinent = (word) => continents.map(continent => continent.toLowerCase()).includes(word.toLowerCase());
                    //función para determinar si una palabra está en la lista de aeropuertos
                    const isAirport = (word) => airports.includes(word);
                    //función para determinar si una palabra está en la lista de idiomas
                    const isLanguage = (word) => languages.map(language => language.toLowerCase()).includes(word.toLowerCase());
                    //función para determinar si una palabra está en la lista de unidades de longitud
                    const isUnitLength = (word) => unitsLength.map(unitLength => unitLength.toLowerCase()).includes(word.toLowerCase());
                    //función para determinar si una palabra está en la lista de unidades de peso
                    const isUnitWeight = (word) => unitsWeight.map(unitWeight => unitWeight.toLowerCase()).includes(word.toLowerCase());
                    //función para determinar si una palabra está en la lista de unidades de velocidad
                    const isUnitSpeed = (word) => unitsSpeed.map(unitSpeed => unitSpeed.toLowerCase()).includes(word.toLowerCase());
                    //función para determinar si una palabra está en la lista de unidades de área
                    const isUnitArea = (word) => unitsArea.map(unitArea => unitArea.toLowerCase()).includes(word.toLowerCase());
                    //función para determinar si una palabra está en la lista de unidades de volumen
                    const isUnitVolume = (word) => unitsVolume.map(unitVolume => unitVolume.toLowerCase()).includes(word.toLowerCase());
                    //función para determinar si una palabra está en la lista de unidades de información (datos)
                    const isUnitInformation = (word) => unitsInformation.includes(word);


                    //expresiones regulares
                    //CIF empresas ej: B12345678
                    const cifRegex = /\b[A-Z]\d{8}\b/;
                    //DNI personas ej: 12345678Y
                    const dniRegex = /\b\d{8}[A-Z]\b/;
                    //mails
                    const emailRegex = /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/;
                    //url que permita https o http o www
                    const urlRegex = /((https?:\/\/)|(www\.))[^\s]+/;
                    //números de teléfono 
                    const phoneNumberRegex = /^(\+?\d{1,4}[\s-]?)?(\d{9,})$/;
                    //fechas tanto con guiones como con barras	ej: 31-10-23 31/10/23 o 31-10-2023 31/10/2023
                    const dateRegex = /\b(?:0[1-9]|[12][0-9]|3[01])[-\/](?:0[1-9]|1[0-2])[-\/](?:19|20)?\d{2}\b/;

                    const abbreviatedText = convertToAbbreviation(inputText);
                    const convertedText = wordsToNumbers(abbreviatedText);

                    //dividimos el texto en palabras
                    const words = convertedText.split(/\s+/);
                    //const words = convertedText.split(/\s+|[\.;,!?]+/);

                    //definimos estilos para custom y no custom
                    const customStyle = "color: red;";
                    const noCustomStyle = "color: green;";

                    //añadir las etiquetas a las palabras
                    const outputText = words.map((word) => {
                        //limpiar la palabra de signos de puntuación
                        let wordClean = word.replace(/[.,;!?]+$/, '');

                        if (isContinent(wordClean)) {
                            //detectar si es continente
                            return `<span style="${customStyle}">${word}($continent)</span>`;

                        } else if (isCarBrand(wordClean)) {
                            //detectar si es alguna marca de coche
                            return `<span style="${customStyle}">${word}($carBrand)</span>`;

                        } else if (isClothingBrand(wordClean)) {
                            //detectar si es alguna marca de ropa
                            return `<span style="${customStyle}">${word}($clothingBrand)</span>`;

                        } else if (word.match(cifRegex)) {
                            //detectar si es cif
                            return `<span style="${customStyle}">${word}($cif)</span>`;

                        } else if (word.match(dniRegex)) {
                            //detectar si es dni
                            return `<span style="${customStyle}">${word}($dni)</span>`;

                        } else if (wordClean.match(phoneNumberRegex)) {
                            //detectar si es número de teléfono
                            return `<span style="${noCustomStyle}">${word}($phone)</span>`;

                        } else if (word.includes('%')) {
                            //detectar si es porcentaje
                            return `<span style="${noCustomStyle}">${word}($percentage)</span>`;

                        } else if (word.match(dateRegex)) {
                            //detectar si es fecha
                            return `<span style="${noCustomStyle}">${word}($date)</span>`;

                        } else if (!isNaN(parseFloat(word))) {
                            //detectar si es número
                            //return word + "($number)";
                            return `<span style="${noCustomStyle}">${word}($number)</span>`;

                        } else if (isCountry(wordClean)) {
                            //detectar si es país
                            return `<span style="${noCustomStyle}">${word}($country)</span>`;

                        } else if (isCountryCapital(wordClean)) {
                            //detectar si es capital
                            return `<span style="${noCustomStyle}">${word}($countryCapital)</span>`;

                        } else if (isUsaState(wordClean)) {
                            //detectar si es estado de EEUU
                            return `<span style="${noCustomStyle}">${word}($usaState)</span>`;

                        } else if (isColor(wordClean)) {
                            //detectar si es color
                            return `<span style="${noCustomStyle}">${word}($color)</span>`;

                        } else if (isAirport(wordClean)) {
                            //detectar si es aeropuerto
                            return `<span style="${noCustomStyle}">${word}($airport)</span>`;

                        } else if (isLanguage(wordClean)) {
                            //detectar si es idioma
                            return `<span style="${noCustomStyle}">${word}($language)</span>`;

                        } else if (isUnitLength(wordClean)) {
                            //detectar si es unidad de longitud
                            return `<span style="${noCustomStyle}">${word}($unitLength)</span>`;

                        } else if (isUnitWeight(wordClean)) {
                            //detectar si es unidad de peso
                            return `<span style="${noCustomStyle}">${word}($unitWeight)</span>`;

                        } else if (isUnitSpeed(wordClean)) {
                            //detectar si es unidad de velocidad
                            return `<span style="${noCustomStyle}">${word}($unitSpeed)</span>`;

                        } else if (isUnitArea(wordClean)) {
                            //detectar si es unidad de área
                            return `<span style="${noCustomStyle}">${word}($unitArea)</span>`;

                        } else if (isUnitVolume(wordClean)) {
                            //detectar si es unidad de volumen
                            return `<span style="${noCustomStyle}">${word}($unitVolume)</span>`;
                            
                        } else if (isUnitInformation(wordClean)) {
                            //detectar si es unidad de información (datos)
                            return `<span style="${noCustomStyle}">${word}($unitInformation)</span>`;

                        } else if (word.match(emailRegex)) {
                            //detectar si es email
                            return `<span style="${noCustomStyle}">${word}($email)</span>`;

                        } else if (word.match(urlRegex)) {
                            //detectar si es url
                            return `<span style="${noCustomStyle}">${word}($url)</span>`;

                        } else {
                            return word;
                        }
                    }).join(" ");

                    //outputTextArea.value = outputText;
                    outputDiv.innerHTML = outputText;
                });
        }

    </script>
</body>

</html>